<UserControl x:Class="StockAnalyzerApp.CustomControl.InstrumentDlgs.InstrumentsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:telerik="http://schemas.telerik.com/2008/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:StockAnalyzerApp.CustomControl.InstrumentDlgs" 
             xmlns:stockClasses="clr-namespace:StockAnalyzer.StockClasses;assembly=StockAnalyzer"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="1000" Background="AntiqueWhite"
             d:DataContext="{d:DesignInstance Type=local:InstrumentViewModel, IsDesignTimeCreatable=False}">
    <UserControl.Resources>
        <telerik:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <local:SaxoMappingStyleSelector x:Key="SaxoMappingStyleSelector" >
            <local:SaxoMappingStyleSelector.NotFoundStyle>
                <Style TargetType="telerik:GridViewCell">
                    <Setter Property="Background" Value="LightCoral"/>
                    <Setter Property="Foreground" Value="White"/>
                </Style>
            </local:SaxoMappingStyleSelector.NotFoundStyle>
        </local:SaxoMappingStyleSelector>
    </UserControl.Resources>
    <Grid>
        <TabControl>
            <TabItem Header="Instruments">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Horizontal">
                        <GroupBox Header="Config">
                            <StackPanel Orientation="Horizontal">
                                <Label Content="Group " Width="50"/>
                                <ComboBox ItemsSource="{Binding Groups}" SelectedValue="{Binding Group}" Width="120" VerticalAlignment="Center"/>

                                <Label Content="Provider " Width="55"/>
                                <ComboBox ItemsSource="{Binding DataProviders}" SelectedValue="{Binding DataProvider}" Width="120" VerticalAlignment="Center"/>

                                <Button Content="{Binding RunStatus}" Click="CalculateBtn_OnClick" Margin="6" VerticalAlignment="Center"/>
                                <Button x:Name="exportToExcel" Height="24" Width="24"  VerticalAlignment="Center"
                            Visibility="{Binding ExportEnabled, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}" 
                            Click="Export_Onclick">
                                    <Image Source="../../Resources/Excel.png" />
                                </Button>

                                <telerik:RadProgressBar Minimum="0" Maximum="{Binding NbStocks}" Value="{Binding Progress}"
                                                    Width="100" Height="10" Margin="1" Visibility="{Binding ProgressVisibility, Mode=OneWay}"/>

                                <Label Content="{Binding Items.Count, ElementName=gridView, Mode=OneWay}" VerticalContentAlignment="Center"/>
                                <Label Content="/" VerticalContentAlignment="Center"/>
                                <Label Content="{Binding Lines.Count}" VerticalContentAlignment="Center"/>


                                <Button Content="Force Download" Click="ForceDownloadBtn_OnClick" Margin="6" VerticalAlignment="Center"/>
                                <Button Content="Exclude Selected" Click="ExcludeSelectedBtn_OnClick" Margin="6" VerticalAlignment="Center"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                    <telerik:RadGridView FontSize="9" Name="gridView" Grid.Row="1" Margin="1,1,1,1" ShowGroupPanel="True" RowIndicatorVisibility="Collapsed"
                             ItemsSource="{Binding Lines}" IsReadOnly="True" AutoGenerateColumns="False"
                             SelectionChanged="RadGridView_SelectionChanged" FrozenColumnCount="5" Grid.ColumnSpan="2">
                        <telerik:RadGridView.Columns>
                            <telerik:GridViewDataColumn Header="Excluded" DataMemberBinding="{Binding StockAnalysis.Excluded}"/>
                            <telerik:GridViewDataColumn Header="Intraday" DataMemberBinding="{Binding Intraday}"/>
                            <telerik:GridViewDataColumn Header="Group" DataMemberBinding="{Binding StockGroup}"/>

                            <telerik:GridViewDataColumn Header="ISIN" DataMemberBinding="{Binding ISIN}"/>
                            <telerik:GridViewDataColumn Header="Name" DataMemberBinding="{Binding StockName}"/>
                            <telerik:GridViewDataColumn Header="Country" DataMemberBinding="{Binding IsinPrefix}"/>
                            <telerik:GridViewDataColumn Header="Symbol" DataMemberBinding="{Binding Symbol}"/>
                            <telerik:GridViewDataColumn Header="ABCName" DataMemberBinding="{Binding ABCName}"/>
                            <telerik:GridViewDataColumn Header="DataProvider" DataMemberBinding="{Binding DataProvider}"/>
                            <telerik:GridViewDataColumn Header="Ticker" DataMemberBinding="{Binding Ticker}"/>
                            <telerik:GridViewDataColumn Header="SaxoId" DataMemberBinding="{Binding SaxoId}"/>
                            <telerik:GridViewDataColumn Header="Uic" DataMemberBinding="{Binding Uic}"/>

                            <telerik:GridViewDataColumn Header="SectorId" DataMemberBinding="{Binding SectorId}"/>
                            <telerik:GridViewDataColumn Header="Underlying" DataMemberBinding="{Binding Underlying}"/>
                            <telerik:GridViewDataColumn Header="Url" DataMemberBinding="{Binding Url}"/>

                            <telerik:GridViewDataColumn Header="Exchanged" DataMemberBinding="{Binding Exchanged}"/>
                            <telerik:GridViewDataColumn Header="Close" DataMemberBinding="{Binding LastValue.CLOSE}"/>
                            <telerik:GridViewDataColumn Header="Last Date" DataMemberBinding="{Binding LastValue.DATE}"/>
                            <telerik:GridViewDataColumn Header="First Date" DataMemberBinding="{Binding FirstValue.DATE}"/>

                            <telerik:GridViewDataColumn Header="LastIndex" DataMemberBinding="{Binding LastIndex}"/>
                            <telerik:GridViewDataColumn Header="LastCompleteIndex" DataMemberBinding="{Binding LastCompleteIndex}"/>
                            <telerik:GridViewDataColumn Header="LastValue" DataMemberBinding="{Binding LastValue}"/>
                            <telerik:GridViewDataColumn Header="HasVolume" DataMemberBinding="{Binding HasVolume}"/>
                            <telerik:GridViewDataColumn Header="IsInitialised" DataMemberBinding="{Binding IsInitialised}"/>
                        </telerik:RadGridView.Columns>
                    </telerik:RadGridView>
                </Grid>
            </TabItem>
            <TabItem Header="Saxo Turbo Underlyings">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Grid.Row="0"  Command="{Binding RefreshCommand}" HorizontalAlignment="Right"  Margin="4">Refresh</Button>
                        <Button Grid.Row="0"  Command="{Binding SaveCommand}" HorizontalAlignment="Right"  Margin="4">Save</Button>
                    </StackPanel>
                    <telerik:RadGridView FontSize="9" Grid.Row="1" ItemsSource="{Binding SaxoUnderlyings}" Margin="4,4,4,4" RowIndicatorVisibility="Collapsed"
                             SelectionUnit="Cell" SelectionMode="Single" ShowGroupPanel="False" AutoGenerateColumns="False" SelectedCellsChanged="RadGridView_SelectedCellsChanged">
                        <telerik:RadGridView.Columns>
                            <telerik:GridViewDataColumn Header="Value" DataMemberBinding="{Binding Id}" IsReadOnly="True"/>
                            <telerik:GridViewDataColumn Header="Saxo Name" DataMemberBinding="{Binding SaxoName}" IsReadOnly="True"/>
                            <telerik:GridViewDataColumn Header="Serie Name" DataMemberBinding="{Binding SerieName}" CellStyleSelector="{StaticResource SaxoMappingStyleSelector}"/>
                        </telerik:RadGridView.Columns>
                    </telerik:RadGridView>
                </Grid>
            </TabItem>
            <TabItem Header="Saxo Instruments">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Grid.Row="0"  Command="{Binding SaveInstrumentsCommand}" HorizontalAlignment="Right"  Margin="4">Save</Button>
                    </StackPanel>
                    <telerik:RadGridView FontSize="9" Grid.Row="1" ItemsSource="{Binding Instruments}" Margin="4,4,4,4" RowIndicatorVisibility="Collapsed"
                             SelectionUnit="Cell" SelectionMode="Single" ShowGroupPanel="False" AutoGenerateColumns="true" SelectedCellsChanged="RadGridView_SelectedCellsChanged">
                        <telerik:RadGridView.Columns>
                            <telerik:GridViewDataColumn Header="Isin" DataMemberBinding="{Binding Isin}" CellStyleSelector="{StaticResource SaxoMappingStyleSelector}"/>
                        </telerik:RadGridView.Columns>
                    </telerik:RadGridView>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>
